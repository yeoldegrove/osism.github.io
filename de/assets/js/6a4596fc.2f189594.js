"use strict";(self.webpackChunkosism=self.webpackChunkosism||[]).push([[7958],{9506:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var a=t(5893),o=t(1151);const i={sidebar_label:"Loadbalancer",sidebar_position:20},l="Loadbalancer",s={id:"guides/configuration-guide/loadbalancer",title:"Loadbalancer",description:"Second Loadbalancer",source:"@site/docs/guides/configuration-guide/loadbalancer.md",sourceDirName:"guides/configuration-guide",slug:"/guides/configuration-guide/loadbalancer",permalink:"/de/docs/guides/configuration-guide/loadbalancer",draft:!1,unlisted:!1,editUrl:"https://github.com/osism/osism.github.io/tree/main/docs/guides/configuration-guide/loadbalancer.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{sidebar_label:"Loadbalancer",sidebar_position:20},sidebar:"tutorialSidebar",previous:{title:"Proxy",permalink:"/de/docs/guides/configuration-guide/proxy"},next:{title:"Self-signed certificates",permalink:"/de/docs/guides/configuration-guide/self-signed-certificates"}},r={},d=[{value:"Second Loadbalancer",id:"second-loadbalancer",level:2}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,o.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"loadbalancer",children:"Loadbalancer"}),"\n",(0,a.jsx)(n.h2,{id:"second-loadbalancer",children:"Second Loadbalancer"}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"This feature is available from OSISM 7.0.5."})}),"\n",(0,a.jsxs)(n.p,{children:["With OSISM, it is possible to manage any number of independent loadbalancers via a single OSISM\nmanager service using sub-environments. A sub environment is basically nothing more than another directory\nbelow the ",(0,a.jsx)(n.code,{children:"environments"})," directory of the configuration repository with a special name."]}),"\n",(0,a.jsxs)(n.p,{children:["A sub-environment for an additional loadbalancer always has the name ",(0,a.jsx)(n.code,{children:"kolla.NAME"})," as the loadbalancer\nis provided as part of Kolla. The ",(0,a.jsx)(n.code,{children:"kolla.NAME"})," directory in the configuration repository then contains\nthe ",(0,a.jsx)(n.code,{children:"configuration.yml"}),", ",(0,a.jsx)(n.code,{children:"images.yml"})," and ",(0,a.jsx)(n.code,{children:"secrets.yml"})," files as usual."]}),"\n",(0,a.jsx)(n.p,{children:"The following directories and files are also required in a sub-environment for a loadbalancer."}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{style:{textAlign:"left"},children:"File"}),(0,a.jsx)(n.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:(0,a.jsx)(n.code,{children:"certificates/ca/custom.crt"})}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"The file is optional. If a custom CA is used, it must be added here."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:(0,a.jsx)(n.code,{children:"certificates/haproxy-internal.pem"})}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"SSL certificate to be used."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:(0,a.jsx)(n.code,{children:"files/overlays/haproxy/services.d/haproxy.cfg"})}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"HAProxy configuration to be used on the loadbalancer."})]})]})]}),"\n",(0,a.jsxs)(n.p,{children:["In this example, a sub-environment ",(0,a.jsx)(n.code,{children:"kolla.external"})," is created, which is used for an outward facing\nloadbalancer that only offers certain API services."]}),"\n",(0,a.jsxs)(n.p,{children:["In comparison to the normal ",(0,a.jsx)(n.code,{children:"kolla"})," environment, the groups to be used must be overwritten for a\nKolla sub-environment. In this case, one group is defined: ",(0,a.jsx)(n.code,{children:"kolla.external.loadbalancer"}),". It is\nrecommended to base the name of the groups on the name of the sub-environments."]}),"\n",(0,a.jsxs)(n.p,{children:["The group ",(0,a.jsx)(n.code,{children:"kolla.external.loadbalancer"})," is added to the global inventory in the ",(0,a.jsx)(n.code,{children:"10-custom"})," file.\nIn this example, ",(0,a.jsx)(n.code,{children:"testbed-node-2.testbed.osism.xyz"})," is used for the second loadbalancer."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ini",metastring:'title="inventory/10-custom"',children:"[kolla.external.loadbalancer]\ntestbed-node-2.testbed.osism.xyz\n"})}),"\n",(0,a.jsxs)(n.p,{children:["It is also important to ensure that the nodes used for the second loadbalancer are not included in\nthe ",(0,a.jsx)(n.code,{children:"loadbalancer"})," group. This can be checked with ",(0,a.jsx)(n.code,{children:"osism get hosts -l loadbalancer"}),". If the nodes of\nthe second loadbalancer are also listed there, the ",(0,a.jsx)(n.code,{children:"loadbalancer"})," group in the ",(0,a.jsx)(n.code,{children:"99-overwrite"})," file of\nthe global inventory must be overwritten. In this example, the ",(0,a.jsx)(n.code,{children:"loadbalaner"})," group is overwritten so\nthat only ",(0,a.jsx)(n.code,{children:"testbed-node-0.testbed.osism.xyz"})," and ",(0,a.jsx)(n.code,{children:"testbed-node-1.testbed.osism.xyz"})," are left in the\n",(0,a.jsx)(n.code,{children:"loadbalancer"})," group."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ini",metastring:'title="inventory/99-overwrite"',children:"[loadbalancer]\ntestbed-node-0.testbed.osism.xyz\ntestbed-node-1.testbed.osism.xyz\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Furthermore, in a Kolla sub-environment that is only used for a loadbalancer, only a few additional\nparameters are required in the ",(0,a.jsx)(n.code,{children:"configuration.yml"})," file."]}),"\n",(0,a.jsxs)(n.p,{children:["Don't get confused, only the ",(0,a.jsx)(n.code,{children:"kolla_*internal*"})," parameters and the ",(0,a.jsx)(n.code,{children:"haproxy-internal.pem"})," file are used\nhere in the example. This is because we only want to configure one virtual IP address on the external\nloadbalancer and the loadbalancer managed by Kolla has the internal IP address by default. It is therefore\nnot possible with Kolla to use only the ",(0,a.jsx)(n.code,{children:"kolla_*external*"})," parameters as an additional virtual IP address\nwith default values would then be configured by default."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/kolla.external/configuration.yml"',children:'---\n##########################################################\n# hosts\n\nhosts_kolla_all: kolla.external.loadbalancer\nhosts_kolla_loadbalancer: kolla.external.loadbalancer\n\n##########################################################\n# docker\n\ndocker_namespace: osism\n\n##########################################################\n# loadbalancer\n\nkolla_internal_vip_address: 192.168.24.200\nkolla_internal_fqdn: api.testbed.osism.com\nkolla_enable_tls_internal: "yes"\n\n# Required if a custom CA is used.\nkolla_copy_ca_into_containers: "yes"\n'})}),"\n",(0,a.jsx)(n.p,{children:"At the moment it is only possible to deploy the loadbalancer itself with its own configuration. It is currently\nnot possible to use the integrated service configurations of Kolla itself (Nova, Cinder, ..) on an additional\nloadbalancer. This will be possible in the future."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"osism apply --sub external loadbalancer-without-service-config\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>l});var a=t(7294);const o={},i=a.createContext(o);function l(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);