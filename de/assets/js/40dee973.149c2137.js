"use strict";(self.webpackChunkosism=self.webpackChunkosism||[]).push([[7383],{8706:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var t=o(5893),s=o(1151);const i={sidebar_label:"Nova"},a="Nova",r={id:"guides/configuration-guide/openstack/nova",title:"Nova",description:"* Nova admin guide",source:"@site/docs/guides/configuration-guide/openstack/nova.md",sourceDirName:"guides/configuration-guide/openstack",slug:"/guides/configuration-guide/openstack/nova",permalink:"/de/docs/guides/configuration-guide/openstack/nova",draft:!1,unlisted:!1,editUrl:"https://github.com/osism/osism.github.io/tree/main/docs/guides/configuration-guide/openstack/nova.md",tags:[],version:"current",frontMatter:{sidebar_label:"Nova"},sidebar:"tutorialSidebar",previous:{title:"Neutron",permalink:"/de/docs/guides/configuration-guide/openstack/neutron"},next:{title:"Octavia",permalink:"/de/docs/guides/configuration-guide/openstack/octavia"}},d={},l=[{value:"Nested virtualisation",id:"nested-virtualisation",level:2},{value:"AMD",id:"amd",level:3},{value:"Intel",id:"intel",level:3},{value:"Reserve compute node resources",id:"reserve-compute-node-resources",level:2},{value:"Host memory",id:"host-memory",level:3},{value:"Host CPUs",id:"host-cpus",level:3},{value:"Local SSD storage",id:"local-ssd-storage",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"nova",children:"Nova"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.openstack.org/nova/latest/admin/index.html",children:"Nova admin guide"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.openstack.org/nova/latest/configuration/index.html",children:"Nova configuration guide"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.openstack.org/nova/latest/configuration/config.html",children:"Nova configuration reference"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"nested-virtualisation",children:"Nested virtualisation"}),"\n",(0,t.jsx)(n.h3,{id:"amd",children:"AMD"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'echo "options kvm-amd nested=y" | sudo tee /etc/modprobe.d/kvm-nested-virtualization.conf\nsudo modprobe -r kvm_amd\nsudo modprobe kvm_amd\ncat /sys/module/kvm_amd/parameters/nested\nY\ndocker restart nova_libvirt\n'})}),"\n",(0,t.jsx)(n.h3,{id:"intel",children:"Intel"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'echo "options kvm-intel nested=y" | sudo tee /etc/modprobe.d/kvm-nested-virtualization.conf\nsudo modprobe -r kvm_intel\nsudo modprobe kvm_intel\ncat /sys/module/kvm_intel/parameters/nested\nY\ndocker restart nova_libvirt\n'})}),"\n",(0,t.jsx)(n.h2,{id:"reserve-compute-node-resources",children:"Reserve compute node resources"}),"\n",(0,t.jsx)(n.p,{children:"How many resources you want to reserve on a compute node depends very much on which additional\nservices are running on the compute node."}),"\n",(0,t.jsx)(n.h3,{id:"host-memory",children:"Host memory"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.openstack.org/nova/latest/configuration/config.html#DEFAULT.reserved_host_memory_mb",children:"https://docs.openstack.org/nova/latest/configuration/config.html#DEFAULT.reserved_host_memory_mb"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",metastring:'title="environments/kolla/files/overlays/nova/nova-compute.conf"',children:"[DEFAULT]\nreserved_host_memory_mb = 32768\n"})}),"\n",(0,t.jsx)(n.h3,{id:"host-cpus",children:"Host CPUs"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.openstack.org/nova/latest/configuration/config.html#DEFAULT.reserved_host_cpus",children:"https://docs.openstack.org/nova/latest/configuration/config.html#DEFAULT.reserved_host_cpus"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",metastring:'title="environments/kolla/files/overlays/nova/nova-compute.conf"',children:"[DEFAULT]\nreserved_host_cpus = 4\n"})}),"\n",(0,t.jsx)(n.h2,{id:"local-ssd-storage",children:"Local SSD storage"}),"\n",(0,t.jsxs)(n.p,{children:["In this example, a local SSD is provided for use on compute node ",(0,t.jsx)(n.code,{children:"testbed-node-0"}),".\nBy default, Nova accesses the local storage on a file basis."]}),"\n",(0,t.jsxs)(n.p,{children:["It is also possible to work with logical volumes instead. However, this is not\nrecommended or supported by OSISM. More details in the\n",(0,t.jsx)(n.a,{href:"https://docs.openstack.org/nova/latest/admin/configuration/index.html",children:"Nova Configuration Guide"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["On the compute node, the local SSD to be used is formatted with a file system of\nyour choice and mounted to ",(0,t.jsx)(n.code,{children:"/var/lib/nova"}),". When using more than one local SSD, a\nsoftware RAID 1 should be used It is recommended to automate the creation of the\nfile system and the creation of the mount point with a custom playbook."]}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.code,{children:"nova.conf"})," configuration file is created as an overlay file for the compute node\n",(0,t.jsx)(n.code,{children:"testbed-node-0"}),". The name of the directory must match the name of the host in the\ninventory. If the compute node has a file with the name ",(0,t.jsx)(n.code,{children:"testbed-node-0.yml"})," in the\n",(0,t.jsx)(n.code,{children:"host_vars"})," directory in the inventory, then the name of the directory\nin the overlays is ",(0,t.jsx)(n.code,{children:"testbed-node-0"})," accordingly. If the file name there were\n",(0,t.jsx)(n.code,{children:"testbed-node-0.testbed.osism.xyz.yml"})," then the name of the directory would be\n",(0,t.jsx)(n.code,{children:"testbed-node-0.testbed.osism.xyz"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",metastring:'title="environments/kolla/files/overlays/nova/testbed-node-0/nova.conf"',children:"[libvirt]\nimages_type = raw\n\n[glance]\nenable_rbd_download = true\n"})}),"\n",(0,t.jsxs)(n.p,{children:["As Ceph is still used as the storage backend for Glance and Cinder, the image type is\nset to ",(0,t.jsx)(n.code,{children:"raw"}),". To allow to download and cache images from Ceph via rbd rather than the\nGlance API via http  ",(0,t.jsx)(n.code,{children:"enable_rbd_download"})," is set to ",(0,t.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Parameters must also be added in the inventory. This differs depending on the OSISM\nversion used."}),"\n",(0,t.jsx)(n.p,{children:"Up to OSISM 6 it looks like this:"}),"\n",(0,t.jsxs)(n.p,{children:["In the inventory, the parameter ",(0,t.jsx)(n.code,{children:"nova_instance_datadir_volume"}),"\nis added in the section for the ",(0,t.jsx)(n.code,{children:"kolla"})," environment."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="inventory/host_vars/testbed-node-0.yml"',children:"##########################################################\n# kolla\n\nnova_instance_datadir_volume: /var/lib/nova\n"})}),"\n",(0,t.jsx)(n.p,{children:"Starting with OSISM 7, it looks like this:"}),"\n",(0,t.jsxs)(n.p,{children:["In the inventory, the parameters ",(0,t.jsx)(n.code,{children:"nova_instance_datadir_volume"})," and ",(0,t.jsx)(n.code,{children:"nova_backend"}),",\nare added in the section for the ",(0,t.jsx)(n.code,{children:"kolla"})," environment."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="inventory/host_vars/testbed-node-0.yml"',children:"##########################################################\n# kolla\n\nnova_instance_datadir_volume: /var/lib/nova\nnova_backend: default\n"})}),"\n",(0,t.jsx)(n.p,{children:"It is currently not possible to completely deactivate the Ceph integration with Nova.\nSo if you have all compute nodes with local storage, you still have to do the Ceph\nintegration for Nova itself and convert each compute node specifically to local storage.\nIf this is not done, errors will occur when deploying Nova."})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},1151:(e,n,o)=>{o.d(n,{Z:()=>r,a:()=>a});var t=o(7294);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);